
Create Table if not exists passenger(
id_passenger int not null ,
rut_passenger int not null,
first_name Varchar (20) not null,
last_name Varchar (20) not null,
phone_number varchar (15) not null,
email Varchar (35) not null,
birthdate date,
primary key (id_passenger));



create table if not exists flight_ticket(
id_ticket int not null ,
id_passenger int not null,
flight_number varchar (10)not null,
first_name Varchar (20)not null, 
last_name Varchar (20) not null,
gate_number Varchar (10) not null,
class_code varchar (10) not null,
seat_number varchar(10) not null, 
date_flight date not null,
primary key (id_ticket)
);


create table if not exists luggage (
id_luggage int not null ,
flight_number int not null,
id_passenger int not null,
first_name Varchar (20) not null,
last_name Varchar (20) not null,
weight int not null,
primary key (id_luggage)
);


create Table if not exists flight (
id_flight int not null,
origen varchar(20)not null,
destination  varchar (20)not null,
passengers_numbers int not null,
name_capitan varchar (20)not null,
last_name_capitan varchar (20)not null,
date_flight date not null,
primary key (id_flight, date_flight));


ALTER TABLE flight ADD INDEX idx_date_flight (date_flight);
Create Table if not exists airport(
id_flight int not null,
id_airline int not null ,
id_Airport Varchar (10) not null,
name_city varchar (20)not null ,
country varchar (20)not null ,
primary key (id_Airport) 
);

Create  Table  if not exists airline  (
id_airline int not null auto_increment,
id_crew int not null,
primary key (id_airline)
);

Create Table  flight_crew(
id_crew int not null Auto_Increment,
id_flight int not null,
rut_crew varchar (30) not null,
first_name Varchar (30) not null,
last_name Varchar (30) not null,
Phone_number varchar (20) not null,
email Varchar (30) not null,
birthday date,
primary key (id_crew)
);

Create Table aircraft (
id_flight int not null,
model varchar (15)not null,
id_plate varchar (15) not null,
flight_hours int not null,
primary key (id_plate)
);

create Table if not exists flight_passenger (
id_flight int not null,
date_flight date not null,
id_passenger int not null ,
primary key (id_flight,date_flight,id_passenger)
);


/*
 select *
 from flight;
 
 select *
 from flight_crew;
 
 select *
 from flight_ticket;
 
  select *
 from passenger;
 
   select *
 from  luggage;
 
   select *
 from airport;  
 
 select *
 from airline;  
 
 select *
 from aircraft;  
 
 select *
 from flight_passenger;
 */




 -- Catidad de  vuelos operaron el mes de febrero de 2023--
DELIMITER $$ 
CREATE FUNCTION cantidad_vuelos  () 
RETURNS int 
DETERMINISTIC
BEGIN 
DECLARE cantidad_vuelos  int ;
-- SQL 
select count(*)  as cantidad_vuelos 
from flight 
where flight.date_flight BETWEEN  '2023-02-01' and '2023-02-28'
limit 1
into cantidad_vuelos;
RETURN cantidad_vuelos;
END$$ 
DELIMITER ;

select cantidad_vuelos();


-- FUNCIONES--

DELIMITER $$ 
CREATE FUNCTION id_vuelo (ciudad varchar(20)) 
RETURNS varchar(20)
DETERMINISTIC 
BEGIN 
DECLARE V_CIUDAD varchar (20);
-- SQL 
select flight.origen into v_ciudad
from flight 
Where flight.id_flight = 1 ;
RETURN V_CIUDAD ;
END$$ 
DELIMITER ;

select id_vuelo (ciudad);


select  get_last_flight_info (id_passenger) from passenger ;

DELIMITER  $$ 


CREATE FUNCTION count_flight_tickets(passenger_id INT) RETURNS INT
BEGIN
    DECLARE ticket_count INT;
    SELECT COUNT(*) INTO ticket_count
    FROM flight_ticket
    WHERE id_passenger = passenger_id;
    RETURN ticket_count;
END

DELIMITER ;

